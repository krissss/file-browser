# Claude AI 协作配置

## 项目信息

**项目名称**: File Browser
**项目描述**: 一个基于 Web 的文件浏览器应用，支持浏览、预览和下载本地文件系统中的文件

**技术栈**:
- Next.js 16.1.6 (App Router)
- React 19.2.3
- TypeScript
- Tailwind CSS 4.x
- pnpm (包管理器)
- Turbopack (开发服务器)

> 详细的技术栈说明请查看 [README.md](../README.md#技术栈)

## 开发规范

### 编码风格
- 使用中文进行所有交流和注释
- 代码风格遵循项目现有的 ESLint 配置
- 使用 TypeScript 类型注解
- 组件采用函数式组件和 Hooks
- 遵循 YAGNI 原则，避免过度设计

### 文件组织
- `/app` - Next.js App Router 目录（页面和 API 路由）
- `/components` - React 组件
- `/app/api` - API 路由（文件操作、预览等）
- `/docs` - 项目文档

### 主题定制
- 支持明亮/暗黑主题切换
- 使用现代紫色作为主题色 (`--accent: #8b5cf6` / `#a78bfa`)
- CSS 变量定义在 `app/globals.css`
- 主题状态存储在 localStorage，key 为 `theme`

### 关键功能实现

#### 文件浏览
- 支持 Directory 和 File 类型，显示文件大小和修改时间
- 使用 Node.js `fs/promises` API 读取文件系统
- 所有文件路径必须经过 `isSafePath()` 验证，防止路径遍历攻击

#### 文件预览
- 支持文本、图片、Markdown、代码高亮
- 图片使用 `/api/image` 路由返回二进制数据
- Markdown 和代码文件使用动态导入，避免 SSR 问题
- 大文件（>50KB）默认使用原文模式，避免语法高亮性能问题

#### 性能优化
- 大文件分块显示，初始显示 1000 行
- 代码高亮使用 `limitContentLines()` 函数限制渲染行数
- 支持渐进式加载（"加载更多"按钮）

#### 响应式设计
- 移动端优先设计
- 最小触摸目标 44x44px
- 预览窗口最大高度 95vh，内容区动态计算

## 开发命令

```bash
pnpm dev          # 启动开发服务器 (Turbopack)
pnpm build        # 构建生产版本
pnpm start        # 启动生产服务器
pnpm lint        # 运行 ESLint
```

## 环境变量

- `FILE_BROWSER_ROOT`: 要浏览的文件系统根路径（默认为项目目录）

## AI 协作指南

### 任务处理流程
1. 理解需求：仔细阅读用户需求，使用中文交流
2. 探索代码库：使用 Glob、Grep、Read 工具理解现有实现
3. 提出方案：对于复杂任务，先提出 2-3 个方案供选择
4. 实施变更：遵循现有代码风格，渐进式修改
5. 测试验证：确保功能正常，无破坏性变更

### 优先级原则
- **YAGNI**: 只实现需要的功能，避免过度设计
- **简洁性**: 优先使用简单解决方案，避免不必要的抽象
- **一致性**: 遵循项目现有模式和命名约定
- **性能**: 注意大文件和列表的性能优化

### 禁止的操作
- 不要提交敏感信息（API keys、密码等）
- 不要忽略错误处理和边界情况
- 不要破坏现有功能（添加新功能时）
- 不要引入不必要的依赖
- 不要创建新文件除非绝对必要（优先编辑现有文件）

### 代码审查重点
- TypeScript 类型安全
- React Hooks 依赖项正确性
- 性能优化（大文件、列表渲染）
- 移动端体验
- 主题切换的视觉一致性
- 文件操作安全性

## 项目特定上下文

### 文件操作安全性
- 所有文件路径必须进行安全检查，防止路径遍历攻击
- 使用 `isSafePath()` 函数验证路径
- API 路由中实现适当的错误处理
- 根目录通过 `process.env.FILE_BROWSER_ROOT` 配置，默认为项目目录

### 大文件处理策略
- 预览 API 限制：1MB
- 大文件阈值：50KB（切换到原文模式）
- 代码高亮：初始显示 1000 行，支持"加载更多"
- 避免在客户端渲染大文件的语法高亮

### 主题切换实现
- CSS 变量用于颜色定义
- `dark` 类添加到 `document.documentElement`
- localStorage 持久化主题选择
- 默认明亮模式

### 已知限制
- 文件预览限制为 1MB（性能考虑）
- 二进制文件无法预览
- 文件上传功能未实现
- 不支持文件夹下载

### 未来优化方向
以下方向供参考，但不一定要实现：
- 添加文件上传功能
- 支持更多文件类型预览（PDF、视频等）
- 添加搜索和过滤功能
- 实现文件拖拽上传
- 添加键盘快捷键支持
- 虚拟滚动优化大文件列表

### 关键文件说明

#### `components/SimpleFileList.tsx`
- 主组件，包含文件列表和预览功能
- 使用动态导入避免 SSR 问题（ReactMarkdown、SyntaxHighlighter）
- 实现大文件性能优化
- 代码高亮支持"加载更多"功能

#### `app/globals.css`
- 定义主题 CSS 变量
- 实现主题切换样式
- 移动端优化（最小触摸目标）
- 减少动画以提高无障碍性

#### `app/api/preview/route.ts`
- 文本文件预览 API
- 实现 `isTextFile()` 函数判断文件类型
- 限制文件大小为 1MB

#### `app/api/files/route.ts`
- 文件列表 API
- 使用 `isSafePath()` 验证路径安全性
- 返回文件元数据（大小、修改时间等）
